<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>SCADPipeline</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #f0f0f0;
      height: 100%;
    }
    body {
      font-family: "Trebuchet MS", "Segoe UI", sans-serif;
      color: #222;
    }
    :root {
      --viewer-width: min(800px, 100%);
      --viewer-height: min(600px, 60vh);
    }
    .page {
      display: grid;
      grid-template-columns: 1fr 220px;
      gap: 0;
      min-height: 100vh;
      align-content: start;
      padding: 24px;
      box-sizing: border-box;
    }
    .viewer {
      display: grid;
      place-items: center;
      position: relative;
      background: #e6e6e6;
      border-radius: 16px;
      border: 1px solid #d2d2d2;
      overflow: hidden;
      height: var(--viewer-height);
      margin: 0 18px 18px 0;
    }
    .viewer-media {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      width: var(--viewer-width);
      height: var(--viewer-height);
      margin: auto;
    }
    .viewer img,
    .viewer canvas {
      width: var(--viewer-width);
      height: var(--viewer-height);
      object-fit: contain;
      background: #f7f7f7;
    }
    .viewer canvas {
      display: none;
    }
    .viewer.stl-mode img {
      display: none;
    }
    .viewer.stl-mode canvas {
      display: block;
    }
    .nav-btn {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 44px;
      border: 0;
      background: rgba(0, 0, 0, 0.08);
      color: #111;
      font-size: 28px;
      cursor: pointer;
      transition: background 0.15s ease;
      z-index: 3;
    }
    .nav-btn:hover {
      background: rgba(0, 0, 0, 0.14);
    }
    .nav-left { left: 0; }
    .nav-right { right: 0; }
    .toggle-btn {
      position: absolute;
      right: 18px;
      top: 18px;
      padding: 10px 14px;
      border-radius: 10px;
      border: 1px solid #c9c9c9;
      background: #f7f7f7;
      cursor: pointer;
      font-size: 13px;
      z-index: 3;
    }
    .toggle-btn:disabled {
      opacity: 0.45;
      cursor: not-allowed;
    }
    .download-btn {
      position: absolute;
      right: 86px;
      top: 18px;
      padding: 10px 14px;
      border-radius: 10px;
      border: 1px solid #c9c9c9;
      background: #f7f7f7;
      color: #111;
      text-decoration: none;
      font-size: 13px;
      z-index: 3;
    }
    .download-btn.disabled {
      opacity: 0.45;
      pointer-events: none;
    }
    .thumbs {
      background: #ffffff;
      border: 1px solid #d2d2d2;
      border-radius: 16px;
      padding: 10px;
      overflow-y: auto;
      margin: 0 0 18px 18px;
    }
    .thumbs h2 {
      margin: 6px 6px 12px;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 1.2px;
      opacity: 0.7;
    }
    .thumbs button {
      display: block;
      width: 100%;
      border: 0;
      padding: 6px;
      background: transparent;
      cursor: pointer;
    }
    .thumbs img {
      width: 100%;
      height: 120px;
      object-fit: cover;
      border-radius: 8px;
      border: 2px solid transparent;
    }
    .thumbs button.active img {
      border-color: #111;
    }
    .status {
      margin-top: 8px;
      font-size: 12px;
      opacity: 0.6;
      text-align: center;
    }
    @media (max-width: 1100px) {
      .page {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto;
      }
      :root {
        --viewer-height: min(60vh, 480px);
      }
      .thumbs {
        display: flex;
        align-items: flex-start;
        gap: 8px;
        overflow-x: auto;
        overflow-y: hidden;
        white-space: nowrap;
        margin: 0 0 18px 0;
      }
      .thumbs h2 {
        margin: 0 10px 0 6px;
        white-space: nowrap;
      }
      #thumbList {
        display: flex;
        gap: 8px;
      }
      .thumbs button {
        width: 140px;
        flex: 0 0 auto;
      }
      .thumbs img {
        height: 90px;
      }
    }
    .readme {
      margin: 0;
      padding: 0;
      background: transparent;
      border: 0;
    }
    .tabs {
      grid-column: 1 / -1;
      display: flex;
      gap: 6px;
      margin-top: 18px;
      border-bottom: 1px solid #d2d2d2;
    }
    .tab-btn {
      border: 1px solid #d2d2d2;
      border-bottom: 0;
      background: #efefef;
      padding: 8px 14px;
      border-radius: 10px 10px 0 0;
      cursor: pointer;
      font-size: 13px;
    }
    .tab-btn.active {
      background: #ffffff;
      color: #111;
      border-color: #d2d2d2;
    }
    .tab-panel {
      grid-column: 1 / -1;
      width: 100%;
      margin: 0 0 48px;
      padding: 24px;
      background: #ffffff;
      border: 1px solid #d2d2d2;
      border-radius: 0 16px 16px 16px;
      box-sizing: border-box;
      color: #222;
    }
    .tab-panel.hidden {
      display: none;
    }
    .page-title {
      grid-column: 1 / -1;
      margin: 8px 0 0;
      font-size: 28px;
      letter-spacing: 0.4px;
    }
    .build-date {
      grid-column: 1 / -1;
      margin: 6px 0 12px;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 1.6px;
      opacity: 0.6;
    }
    .readme h2 {
      margin: 0 0 16px;
      font-size: 18px;
    }
    .readme pre {
      white-space: pre-wrap;
      word-break: break-word;
      background: #f7f7f7;
      padding: 12px 14px;
      border-radius: 10px;
      overflow: auto;
    }
  </style>

  <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js"
    }
  }
  </script>
</head>

<body>

<div class="page">
  <h1 class="page-title">SCADPipeline</h1>
<div class="build-date">January 31, 2026</div>
  <div class="viewer" id="viewer">
    <button class="nav-btn nav-left" id="prevBtn" aria-label="Previous image">â—€</button>
    <div class="viewer-media" id="viewerMedia">
      <img id="mainImage" alt="Selected preview" />
    </div>
    <button class="nav-btn nav-right" id="nextBtn" aria-label="Next image">â–¶</button>
    <a class="download-btn" id="downloadLink" href="#" download>Download STL</a>
    <button class="toggle-btn" id="toggleViewer" disabled>3D</button>
  </div>
  <aside class="thumbs">
    <h2>&nbsp;</h2>
    <div id="thumbList"></div>
    <div class="status" id="status"></div>
  </aside>
  <div class="tabs">
    <button class="tab-btn active" data-tab="readme">README</button>
    <button class="tab-btn" data-tab="license">LICENSE</button>
  </div>
  <section class="tab-panel" id="readme-tab">
    <section class="readme"><h1>SCADPipeline</h1>
<p>A reusable CI/CD toolchain for OpenSCAD projects</p>
<p>SCADPipeline turns OpenSCAD designs into a <strong>software-style build pipeline</strong>:</p>
<ul>
<li>Parametric models in Git</li>
<li>Deterministic STL builds in CI</li>
<li>Web-based 3D previews</li>
<li>Versioned, downloadable releases</li>
</ul>
<p>This repository contains both a <strong>reference implementation</strong> (a cube and a cylinder) and the <strong>pipeline itself</strong>, which you can reuse across your own design projects without forking.</p>
<hr />
<h2>3D Preview</h2>
<p>ðŸ‘‰ <strong>Interactive viewer:</strong>
<a href="https://numberformat.github.io/SCADPipeline/">https://numberformat.github.io/SCADPipeline/</a></p>
<p>ðŸ‘‰ <strong>Download STL:</strong>
<a href="https://github.com/numberformat/SCADPipeline/releases/latest">Latest Release</a></p>
<p>The geometry here is intentionally simple.
The point of this repo is not the shapes â€” it is the <strong>build system</strong>.</p>
<hr />
<h2>What this repository is</h2>
<p>This project serves two roles:</p>
<ol>
<li>A minimal example OpenSCAD project (cube + cylinder)</li>
<li>A production-grade pipeline that can be imported into other repositories</li>
</ol>
<p>You can browse, build, and preview this repo directly â€” or you can treat it as an <strong>OpenSCAD toolchain</strong> and pull it into your own design projects.</p>
<hr />
<h2>Design principles</h2>
<ul>
<li><strong>Source, not artifacts, live in Git</strong></li>
<li><strong>Generated STLs are built in CI</strong></li>
<li><strong>Pre-built assets are inputs</strong>, committed under <code>src/assets/</code></li>
<li><strong>CI is the compiler</strong></li>
<li><strong>Pages is a viewer</strong>, not a build system</li>
</ul>
<hr />
<h2>How it works</h2>
<ul>
<li>Builds run inside a Docker container with OpenSCAD preinstalled.</li>
<li>The repo is bind-mounted into the container; outputs are written to <code>site/</code>.</li>
<li>The viewer loads <code>site/models.json</code> to populate the model dropdown.</li>
<li>GitHub Actions runs the same containerized build.</li>
</ul>
<p>Everything that works locally also works in CI.</p>
<hr />
<h2>Local build (Docker only)</h2>
<p>Requirements: Docker Desktop (or Docker Engine).
The build runs in a container and auto-builds the local image as needed.</p>
<p>If you use the GitHub setup wizard, your token is saved to <code>~/.scadpipeline</code> on your host.
When creating a classic PAT, use minimal scopes:
- public repos only: <code>public_repo</code>
- private repos: <code>repo</code>
- org repos: <code>admin:org</code>
Avoid <code>delete_repo</code> and <code>project</code> unless you explicitly need them.</p>
<p><strong>macOS/Linux (bash):</strong></p>
<pre><code class="language-bash">./pipeline.sh build
</code></pre>
<p><strong>Windows/macOS/Linux (PowerShell 7+):</strong></p>
<pre><code class="language-powershell">.\pipeline.ps1 build
</code></pre>
<p>Both scripts run the same Docker container and:</p>
<ul>
<li>Create <code>site/</code></li>
<li>Copy <code>docs/index.html</code> and <code>.nojekyll</code></li>
<li>Append <code>README.md</code> (rendered as HTML) to the end of the viewer page</li>
<li>Render each <code>*.scad</code> in <code>src/models/</code> to <code>site/*.stl</code></li>
<li>Copy pre-built assets from <code>src/assets/</code> into <code>site/assets/</code></li>
<li>Render PNG previews for each STL into <code>site/images/</code> with an <code>_stl</code> suffix</li>
<li>Generate <code>site/models.json</code> for the viewer dropdown</li>
</ul>
<p>The viewer lists both compiled STLs (from <code>src/models/</code>) and pre-built STLs (from <code>src/assets/</code>). For simplicity, the build uses <strong>top-level files only</strong> (no recursion).</p>
<p>Preview image size defaults to <code>1200,900</code> and can be overridden with <code>OPENSCAD_IMAGE_SIZE</code> (format: <code>WIDTH,HEIGHT</code>).</p>
<hr />
<h3>Assets-only projects</h3>
<p>You can use SCADPipeline without OpenSCAD sources at all.</p>
<p>Put your <code>*.stl</code> files in <code>src/assets/</code> and leave <code>src/models/</code> empty.
The build will publish your pre-built STLs into the viewer with no <code>.scad</code> files required.</p>
<hr />
<h3>Run the viewer</h3>
<p>Serve the built site locally (defaults to <a href="http://localhost:8080">http://localhost:8080</a>; if taken, the script picks the next available port). You can override with <code>SITE_PORT</code>.</p>
<pre><code class="language-bash">./pipeline.sh run
</code></pre>
<pre><code class="language-powershell">.\pipeline.ps1 run
</code></pre>
<hr />
<h3>Clean artifacts</h3>
<p>Remove all generated build output.</p>
<pre><code class="language-bash">./pipeline.sh clean
</code></pre>
<pre><code class="language-powershell">.\pipeline.ps1 clean
</code></pre>
<hr />
<h2>Using SCADPipeline in Your Own Projects (No Forking Required)</h2>
<p>SCADPipeline is designed to be reused across many OpenSCAD design projects without forking this repository or dealing with Git submodules.</p>
<p>Instead, each design project pulls a <strong>snapshot</strong> of the SCADPipeline build system using a small update script.
This gives you all of the CI/CD, viewer, and build logic â€” without inheriting this repositoryâ€™s history or demo models.</p>
<p>Think of SCADPipeline as a <strong>toolchain</strong>, not a template.</p>
<hr />
<h3>How it works</h3>
<p>SCADPipeline publishes itself as a downloadable snapshot via GitHub.
Your project pulls that snapshot and copies the pipeline files into your repo.</p>
<p>Your design stays yours.
The pipeline stays updatable.</p>
<p>You choose when to upgrade.</p>
<hr />
<h3>Step 1 â€” Add the update script to your project</h3>
<p>In the root of your own OpenSCAD project, add one of these:</p>
<h4>macOS / Linux</h4>
<p>Create <code>get_pipeline.sh</code>:</p>
<pre><code class="language-bash">#!/usr/bin/env bash
set -e

REPO_URL=&quot;https://github.com/numberformat/SCADPipeline/archive/refs/heads/main.zip&quot;
TMP_DIR=&quot;$(mktemp -d)&quot;

echo &quot;Downloading SCADPipeline...&quot;
curl -L &quot;$REPO_URL&quot; -o &quot;$TMP_DIR/pipeline.zip&quot;

echo &quot;Extracting...&quot;
unzip -q &quot;$TMP_DIR/pipeline.zip&quot; -d &quot;$TMP_DIR&quot;

PIPELINE_DIR=&quot;$(find &quot;$TMP_DIR&quot; -maxdepth 1 -type d -name &quot;SCADPipeline-*&quot;)&quot;

# Copy the pipeline into this project
rsync -av \
  --exclude 'examples/' \
  --exclude '*.scad' \
  --exclude 'LICENSE' \
  &quot;$PIPELINE_DIR/&quot; \
  &quot;./&quot;

cp &quot;$PIPELINE_DIR/README.md&quot; &quot;./README_pipeline.md&quot;
if [ -f &quot;./README_template.md&quot; ]; then
  mv &quot;./README_template.md&quot; &quot;./README.md&quot;
fi

mkdir -p src/assets src/config src/images src/lib src/models

rm -rf &quot;$TMP_DIR&quot;

echo &quot;SCADPipeline updated.&quot;
</code></pre>
<p>This also creates <code>src/images/</code> for optional user-provided images.</p>
<p>Then make it executable:</p>
<pre><code class="language-bash">chmod +x get_pipeline.sh
</code></pre>
<hr />
<h4>Windows (PowerShell)</h4>
<p>Create <code>get_pipeline.ps1</code>:</p>
<pre><code class="language-powershell">$RepoUrl = &quot;https://github.com/numberformat/SCADPipeline/archive/refs/heads/main.zip&quot;
$Temp = New-Item -ItemType Directory -Path ([System.IO.Path]::GetTempPath() + [System.Guid]::NewGuid())

Write-Host &quot;Downloading SCADPipeline...&quot;
Invoke-WebRequest $RepoUrl -OutFile &quot;$Temp\pipeline.zip&quot;

Write-Host &quot;Extracting...&quot;
Expand-Archive &quot;$Temp\pipeline.zip&quot; &quot;$Temp&quot;

$PipelineDir = Get-ChildItem $Temp | Where-Object { $_.Name -like &quot;SCADPipeline-*&quot; } | Select-Object -First 1

# Copy everything except example models
Get-ChildItem $PipelineDir.FullName -Recurse | Where-Object {
    $_.FullName -notmatch &quot;\\examples\\&quot; -and
    $_.Extension -ne &quot;.scad&quot; -and
    $_.FullName -notmatch &quot;(?:^|[\\/])LICENSE$&quot;
} | ForEach-Object {
    $target = $_.FullName.Replace($PipelineDir.FullName, (Get-Location).Path)
    New-Item -ItemType Directory -Path (Split-Path $target) -Force | Out-Null
    Copy-Item $_.FullName $target -Force
}

Copy-Item (Join-Path $PipelineDir.FullName &quot;README.md&quot;) (Join-Path (Get-Location).Path &quot;README_pipeline.md&quot;) -Force
if (Test-Path &quot;README_template.md&quot;) {
  Move-Item &quot;README_template.md&quot; &quot;README.md&quot; -Force
}

New-Item -ItemType Directory -Path &quot;src/assets&quot;,&quot;src/config&quot;,&quot;src/images&quot;,&quot;src/lib&quot;,&quot;src/models&quot; -Force | Out-Null

Remove-Item $Temp -Recurse -Force
Write-Host &quot;SCADPipeline updated.&quot;
</code></pre>
<p>This also creates <code>src/images/</code> for optional user-provided images.</p>
<hr />
<h3>Step 2 â€” Pull SCADPipeline into your project</h3>
<p>Run the script from your project root:</p>
<p><strong>macOS / Linux</strong></p>
<pre><code class="language-bash">./get_pipeline.sh
</code></pre>
<p><strong>Windows</strong></p>
<pre><code class="language-powershell">.\get_pipeline.ps1
</code></pre>
<p>This copies all CI/CD, viewer, and build logic from SCADPipeline into your project.</p>
<p>Your own <code>.scad</code> models are not touched.</p>
<hr />
<h3>Step 3 â€” Commit the pipeline into your repo</h3>
<p>After pulling the pipeline, commit the files:</p>
<pre><code class="language-bash">git add .
git commit -m &quot;Add SCADPipeline build system&quot;
</code></pre>
<p>Your project now has a frozen, reproducible version of the SCADPipeline.</p>
<hr />
<h3>Updating the pipeline later</h3>
<p>Whenever you want the latest version:</p>
<pre><code class="language-bash">./get_pipeline.sh
# or
.\get_pipeline.ps1
</code></pre>
<p>Then commit the changes.</p>
<p>This gives you <strong>opt-in upgrades</strong> â€” no breaking changes unless you choose them.</p>
<hr />
<h3>Why this is better than forking</h3>
<p>Forks rot.
Submodules confuse people.
Monorepos tangle unrelated designs.</p>
<p>This approach gives you:</p>
<p>â€¢ Full isolation per design
â€¢ Reproducible builds
â€¢ Zero Git coupling
â€¢ CI/CD that just works
â€¢ A real pipeline you can version</p>
<p>SCADPipeline becomes your <strong>OpenSCAD toolchain</strong>, not your projectâ€™s parent.</p>
<hr />
<h2>Releases</h2>
<p>Each successful build on <code>main</code> creates a GitHub Release with:</p>
<ul>
<li>A versioned tag</li>
<li>Generated STL files attached as assets</li>
</ul>
<h2>GitHub Pages</h2>
<p>This build pipeline includes a viewer that publishes your model objects to GitHub Pages.</p>
<p>GitHub Pages is a free hosting service for static sites. It needs to be enabled for each repo (it is off by default).</p>
<p><strong>Optional (guided, console-only auth supported):</strong></p>
<pre><code class="language-bash">./pipeline.sh create-github
</code></pre>
<pre><code class="language-powershell">.\pipeline.ps1 create-github
</code></pre>
<p>The setup will initialize a git repo if needed, commit your current files, and ask how to handle any existing <code>origin</code> remote.</p>
<p>If GitHub Actions is disabled in the new repo, enable it here:</p>
<pre><code>https://github.com/&lt;owner&gt;/&lt;repo&gt;/settings/actions
</code></pre>
<p>After GitHub Actions publishes the <code>gh-pages</code> branch, enable Pages here:</p>
<pre><code>https://github.com/&lt;owner&gt;/&lt;repo&gt;/settings/pages
</code></pre>
<ol>
<li>Go to your repository <strong>Settings</strong>.</li>
<li>Select <strong>Pages</strong> in the left nav.</li>
<li>Under <strong>Source</strong>, choose <strong>Deploy from a Branch</strong>.</li>
<li>Select the <code>gh-pages</code> branch and <code>/ (root)</code> as the folder.</li>
<li>Click <strong>Save</strong>. Within a few minutes, your viewer (with compiled STLs) will be live.</li>
</ol>
<hr />
<h2>License</h2>
<p>This repository is licensed under the MIT License. OpenSCAD models (<code>src/models/</code>) and pre-built assets (<code>src/assets/</code>) may be governed by their own licenses; check each asset before reuse.</p>
<hr />
<h2>Why this matters</h2>
<p>This repository demonstrates a simple but powerful idea:</p>
<blockquote>
<p><strong>Geometry can be built, versioned, reviewed, and published the same way software is.</strong></p>
</blockquote>
<p>Once you remove the GUI dependency, CAD becomes:</p>
<ul>
<li>Automatable</li>
<li>Reviewable</li>
<li>Reproducible</li>
<li>Shareable</li>
</ul></section>
  </section>
  <section class="tab-panel hidden" id="license-tab">
    <section class="license"><pre>MIT License

Copyright (c) 2026 NOAMi (https://noami.us)

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
</pre></section>
  </section>
</div>

<script type="module">
import * as THREE from "three";
import { STLLoader } from "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/loaders/STLLoader.js";
import { OrbitControls } from "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/controls/OrbitControls.js";

const mainImage = document.getElementById("mainImage");
const thumbList = document.getElementById("thumbList");
const statusEl = document.getElementById("status");
const prevBtn = document.getElementById("prevBtn");
const nextBtn = document.getElementById("nextBtn");
const toggleBtn = document.getElementById("toggleViewer");
const downloadLink = document.getElementById("downloadLink");
const viewer = document.getElementById("viewer");
const viewerMedia = document.getElementById("viewerMedia");
const tabButtons = [...document.querySelectorAll(".tab-btn")];
const readmeTab = document.getElementById("readme-tab");
const licenseTab = document.getElementById("license-tab");

let images = [];
let current = 0;
let stlMode = false;

/* Three.js viewer */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0xf7f7f7);

const camera = new THREE.PerspectiveCamera(
  60,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);
camera.position.set(40, 40, 40);

const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setPixelRatio(window.devicePixelRatio);
viewerMedia.appendChild(renderer.domElement);

new OrbitControls(camera, renderer.domElement);
scene.add(new THREE.AmbientLight(0xffffff, 0.85));
const dirLight = new THREE.DirectionalLight(0xffffff, 0.4);
dirLight.position.set(2, 3, 4);
scene.add(dirLight);

const loader = new STLLoader();
let currentMesh = null;
let currentEdges = null;

function setStatus(message) {
  statusEl.textContent = message || "";
}

function setTab(name) {
  tabButtons.forEach(btn => {
    btn.classList.toggle("active", btn.dataset.tab === name);
  });
  readmeTab.classList.toggle("hidden", name !== "readme");
  licenseTab.classList.toggle("hidden", name !== "license");
}

function setActive(index) {
  current = index;
  const item = images[current];
  mainImage.src = item.src;
  stlMode = false;
  viewer.classList.remove("stl-mode");
  toggleBtn.textContent = "3D";
  toggleBtn.disabled = !item.stl;
  if (item.stl) {
    downloadLink.href = item.stl;
    downloadLink.classList.remove("disabled");
  } else {
    downloadLink.href = "#";
    downloadLink.classList.add("disabled");
  }
  [...thumbList.querySelectorAll("button")].forEach((btn, i) => {
    btn.classList.toggle("active", i === current);
  });
}

function buildThumbs() {
  thumbList.innerHTML = "";
  images.forEach((item, i) => {
    const btn = document.createElement("button");
    const img = document.createElement("img");
    img.src = item.src;
    img.alt = `Thumbnail ${i + 1}`;
    btn.addEventListener("click", () => setActive(i));
    btn.appendChild(img);
    thumbList.appendChild(btn);
  });
}

function next() {
  if (!images.length) return;
  setActive((current + 1) % images.length);
}

function prev() {
  if (!images.length) return;
  setActive((current - 1 + images.length) % images.length);
}

prevBtn.addEventListener("click", prev);
nextBtn.addEventListener("click", next);

window.addEventListener("keydown", (event) => {
  if (event.key === "ArrowRight") next();
  if (event.key === "ArrowLeft") prev();
});

tabButtons.forEach(btn => {
  btn.addEventListener("click", () => setTab(btn.dataset.tab));
});

function loadStl(stlPath) {
  setStatus("Loading STL...");
  loader.load(
    stlPath,
    geometry => {
      geometry.center();
      if (currentMesh) scene.remove(currentMesh);
      if (currentEdges) scene.remove(currentEdges);
      const material = new THREE.MeshStandardMaterial({
        color: 0xffff66,
        metalness: 0.0,
        roughness: 0.9
      });
      currentMesh = new THREE.Mesh(geometry, material);
      scene.add(currentMesh);
      const edges = new THREE.EdgesGeometry(geometry);
      currentEdges = new THREE.LineSegments(
        edges,
        new THREE.LineBasicMaterial({ color: 0x000000 })
      );
      scene.add(currentEdges);
      setStatus("");
    },
    undefined,
    () => setStatus("Failed to load STL")
  );
}

function toggleViewer() {
  const item = images[current];
  if (!item.stl) return;
  stlMode = !stlMode;
  viewer.classList.toggle("stl-mode", stlMode);
  toggleBtn.textContent = stlMode ? "Image" : "3D";
  if (stlMode) loadStl(item.stl);
}

toggleBtn.addEventListener("click", toggleViewer);

function resize() {
  const rect = viewerMedia.getBoundingClientRect();
  const width = rect.width;
  const height = rect.height;
  if (width === 0 || height === 0) return;
  camera.aspect = width / height;
  camera.updateProjectionMatrix();
  renderer.setSize(width, height);
}

window.addEventListener("resize", resize);

function animate() {
  requestAnimationFrame(animate);
  renderer.render(scene, camera);
}
animate();

async function init() {
  try {
    const res = await fetch("images.json");
    images = await res.json();
    if (!Array.isArray(images) || images.length === 0) throw new Error("empty");
    buildThumbs();
    setActive(0);
    resize();
    setTab("readme");
  } catch (err) {
    setStatus("No images found.");
  }
}

init();
</script>

</body>
</html>
